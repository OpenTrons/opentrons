# Overview

This is a simple browser tool which can be used to generate labware definitions for _regular_ labware (labware that is
laid out on a grid, and where all wells have consistent dimensions), or _irregular_ labware.

### What is a 'regular' labware?

This is a geometric sense of the word "regular". A labware in which:

- grid shape is uniform (a single regular grid, where each column and each row has a consistent number of wells)
- spacing between columns and rows remains consistent throughout the labware
- the overall height remains consistent throughout the labware

### What is an 'irregular' labware?

Any labware that does not meet the criteria of 'regular'. A labware is irregular if it has:

- more than one grid defining the x-y position of wells (such as a diamond arrangement)
- differing well dimensions (depth, diameter, shape, etc)
- differing numbers of wells from row to row or column to column
- any other dimensional irregularity

## Launching the Tool

First you should make sure that you run `make install` within the `opentrons` top level folder.
If you are up-to-date on all other directories you can simply run `yarn` instead.
Next you have two options:

1. From the top level folder type: `make -C labware-designer dev`
2. Open your browser and type in: `localhost:8080`

OR

1. From the top level folder type: `make -C labware-designer`
2. Open `labware-designer/dist/index.html` in your browser

- In the browser window, open the console (in Chrome, right click in the middle of the page, select "Inspect" and then select the "Console" tab--other browsers vary but are similar).
- In the console, you can use the global variable `sharedData` and use any public functions which are exported in that project.

## What function do I need to use?

The generator functions are called `createRegularLabware` and `createIrregularLabware`. You can use it in the browser
by typing `sharedData.createRegularLabware(options)` or `sharedData.createIrregularLabware(options)`

### What data is needed?

To build a _regular_ labware, the `options` object should have the following shape:

```js
const options = {
  metadata: Metadata,
  parameters: Parameters,
  offset: Offset,
  dimensions: Dimensions,
  grid: Grid,
  spacing: Spacing,
  well: Well,
  brand?: Brand,
}
const labware = sharedData.createRegularLabware(options)
```

To build an _irregular_ labware, the `options` object should have the following shape:

```js
const options = {
  metadata: Metadata,
  parameters: Parameters,
  offset: Offset,
  dimensions: Dimensions,
  grid: Array<Grid>,
  spacing: Array<Spacing>,
  well: Array<Well>,
  gridStart: Array<GridStart>,
  brand?: Brand,
}
const labware = sharedData.createIrregularLabware(options)
```

The above inputs are all required except for `brand`. Each individual input has the following shape(s).

#### Metadata

```js
metadata = {
  displayName: string,
  displayCategory: string,
  displayVolumeUnits?: string,
  displayLengthUnits?: string,
  tags?: Array<string>,
}
```

"displayName" is the name of the labware in the Opentrons App, Protocol Designer, and other client apps (i.e.: "Opentrons 96 PCR plate" or similar)

"displayCategory" is what category the container type falls into. It must be one of:

- "wellPlate"
- "tubeRack"
- "tipRack"
- "trough"
- "trash"
- "other"

"tags" is a list of generic words that describe this labware such as shape of bottom, color or other important factors

#### Parameters

```js
parameters = {
  format: string,
  isTiprack: boolean,
  tipLength?: number, // required if "isTiprack" is true
  isMagneticModuleCompatible: boolean,
  magneticModuleEngageHeight?: number, // required if "isMagneticModuleCompatible" is true
}
```

Format is used to determine how a multichannel pipette may (or may not) interact with this labware.

There are currently four categories:

- irregular (any type of container a multichannel cannot access -- most tuberacks, irregular labware etc)
- 96Standard (any container in a 96 format: well plate or tiprack)
- 384Standard (any container in a 96 format: well plate or tiprack)
- trough

Note: The parameters schema includes a `loadName` field, but this should not be set by the user. It is generated by the program as:

```js
loadName = `${brand}_${numWells}_${displayCategory}_${totalVol}_${displayVolumeUnits}`.toLowerCase()
```

#### Well

```js
well = {
  depth: number,
  shape: string,
  diameter?: number,
  length?: number,
  width?: number,
  totalLiquidVolume: number,
}
```

"depth" is how deep a given well is.

"shape" is what type of well you are dealing with. Currently there are two options:

- "circular" (if of this shape, diameter is required)
- "rectangular" (if of this shape, width and length is required)

"width" corresponds to the Y axis on the deck of the OT2, and "length" corresponds to the X axis

"totalLiquidVolume" is the actual working volume of the well, in the units specified in "displayLiquidVolume" (default
is uL)

Note: The well schema includes `x`, `y`, and `z` fields, but they should not be set by the user. The generator functions will calculate well positions.

#### Grid

```js
grid = {
  row: number,
  column: number,
}
```

Grid is the number of rows and columns in a given labware

#### Spacing

```js
spacing = {
  row: number,
  column: number,
}
```

Spacing is the center to center distance of wells between rows and columns

#### Offset

```js
offset = {
  x: number,
  y: number,
  z: number,
}
```

Offset is taken from the **upper left corner of the labware, flush with the deck** to the top-center of well `A1`.

#### Dimensions

```js
dimensions = {
  overallLength: number,
  overallWidth: number,
  overallHeight: number,
}
```

"overallLength" is the outer dimension of the labware in the X axis in mm--usually equal to the length of the slot: 127.76 mm.

"overallWidth" is the outer dimension of the labware in the Y axis in mm--usually equal to the width of the slot: 85.48 mm.

"overallHeight" is the outer dimension of the labware in the Z axis in mm--usually the same as the top the well, but can be higher in case of some kind of veritcal protrusion.

#### GridStart

```js
gridStart = {
  rowStart: string,
  colStart: string,
  rowStride: number,
  colStride: number,
}
```

GridStart is used to generate well names for irregular labware. The object represents creating a "range" of well names with step intervals included. For example, starting at well "A1" with a column stride of 2 would result in the grid names being ordered as: "A1", "B1", ...; "A3", "B3", ...; etc.

#### Brand

```js
brand = {
  brand: string,
  brandId: optionalString,
}
```

"brand" is the name of the manufacturer

"brandId" is used when a definition accurately reflects several products

If `brand` is omitted from the input, the resulting definition will have: `"brand": {"brand": "generic"}`.

## Explanation of Numerical inputs

See diagram below:

![Labware Dimension Diagram](https://user-images.githubusercontent.com/31892318/48797647-c35ffa80-ecd0-11e8-823a-e40f903a90c8.png)

## Example Input-Output

Given this sequence of commands in the console:

```js
const arguments = {
  metadata: {
    displayName: 'Opentrons 1.5mL tube rack',
    displayCategory: 'tubeRack',
    displayVolumeUnits: 'mL',
  },
  parameters: {format: 'irregular', isTiprack: false},
  offset: {x: 18.213, y: 10.075, z: 79.85},
  dimensions: {
    overallLength: 127.76,
    overallWidth: 85.48,
    overallHeight: 79.85,
  },
  grid: {row: 4, column: 6},
  spacing: {row: 19.278, column: 19.892},
  well: {
    depth: 38.58,
    shape: 'circular',
    diameter: 9.9,
    totalLiquidVolume: 1.5,
  },
  brand: {brand: 'Opentrons'},
}

const data = sharedData.createRegularLabware(arguments)
JSON.stringify(data, null, 2)
```

The output should look like this:

```json
{
  "ordering": [
    ["A1", "B1", "C1", "D1"],
    ["A2", "B2", "C2", "D2"],
    ["A3", "B3", "C3", "D3"],
    ["A4", "B4", "C4", "D4"],
    ["A5", "B5", "C5", "D5"],
    ["A6", "B6", "C6", "D6"]
  ],
  "otId": "b7df6160-e775-11e8-b0a9-079879741b02",
  "deprecated": false,
  "metadata": {
    "displayName": "Opentrons 1.5mL tube rack",
    "displayCategory": "tubeRack",
    "displayVolumeUnits": "mL"
  },
  "cornerOffsetFromSlot": {
    "x": 0,
    "y": 0,
    "z": 0
  },
  "dimensions": {
    "overallLength": 127.76,
    "overallWidth": 85.48,
    "overallHeight": 79.85
  },
  "parameters": {
    "format": "irregular",
    "isTiprack": false,
    "loadName": "opentrons_24_tuberack_1.5_ml_eppendorf"
  },
  "wells": {
    "D1": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 18.21,
      "y": 10.08,
      "z": 41.27
    },
    "C1": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 18.21,
      "y": 29.35,
      "z": 41.27
    },
    "B1": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 18.21,
      "y": 48.63,
      "z": 41.27
    },
    "A1": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 18.21,
      "y": 67.91,
      "z": 41.27
    },
    "D2": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 38.11,
      "y": 10.08,
      "z": 41.27
    },
    "C2": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 38.11,
      "y": 29.35,
      "z": 41.27
    },
    "B2": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 38.11,
      "y": 48.63,
      "z": 41.27
    },
    "A2": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 38.11,
      "y": 67.91,
      "z": 41.27
    },
    "D3": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 58,
      "y": 10.08,
      "z": 41.27
    },
    "C3": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 58,
      "y": 29.35,
      "z": 41.27
    },
    "B3": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 58,
      "y": 48.63,
      "z": 41.27
    },
    "A3": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 58,
      "y": 67.91,
      "z": 41.27
    },
    "D4": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 77.89,
      "y": 10.08,
      "z": 41.27
    },
    "C4": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 77.89,
      "y": 29.35,
      "z": 41.27
    },
    "B4": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 77.89,
      "y": 48.63,
      "z": 41.27
    },
    "A4": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 77.89,
      "y": 67.91,
      "z": 41.27
    },
    "D5": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 97.78,
      "y": 10.08,
      "z": 41.27
    },
    "C5": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 97.78,
      "y": 29.35,
      "z": 41.27
    },
    "B5": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 97.78,
      "y": 48.63,
      "z": 41.27
    },
    "A5": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 97.78,
      "y": 67.91,
      "z": 41.27
    },
    "D6": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 117.67,
      "y": 10.08,
      "z": 41.27
    },
    "C6": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 117.67,
      "y": 29.35,
      "z": 41.27
    },
    "B6": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 117.67,
      "y": 48.63,
      "z": 41.27
    },
    "A6": {
      "depth": 38.58,
      "shape": "circular",
      "diameter": 9.9,
      "totalLiquidVolume": 1.5,
      "x": 117.67,
      "y": 67.91,
      "z": 41.27
    }
  },
  "brand": {
    "brand": "Opentrons"
  }
}
```
