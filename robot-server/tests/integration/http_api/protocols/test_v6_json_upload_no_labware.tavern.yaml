test_name: Upload, analyze, delete basic_transfer_standalone protocol.

marks:
  - usefixtures:
      - run_server
stages:
  - name: Upload simple v6 protocol
    request:
      url: '{host:s}:{port:d}/protocols'
      method: POST
      files:
        files: '../shared-data/protocol/fixtures/6/simpleV6_no_labware.json'
    response:
      strict:
        - json:off
      save:
        json:
          protocol_id: data.id
          analysis_id: data.analysisSummaries[0].id
      status_code: 201
      json:
        data:
          id: !anystr
          protocolType: json
          analysisSummaries:
            - id: !anystr
              status: pending
  - name: Create a run
    request:
      url: '{host:s}:{port:d}/runs'
      method: POST
      json:
        data:
          protocolId: '{protocol_id}'
    response:
      strict:
        - json:off
      status_code: 422
      json:
        errors:
          - id: ProtocolFilesInvalid
            title: Protocol File(s) Invalid
            detail: "Missing loaded labware id: sourcePlateId-not-exists. Invalid protocol."
