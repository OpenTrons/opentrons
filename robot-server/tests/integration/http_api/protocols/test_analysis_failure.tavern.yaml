test_name: Upload, analyze, and validate protocol analysis failure for api level.

marks:
  - usefixtures:
      - run_server
stages:
  - name: Upload a python protocol with non-conforming api level 
    request:
      url: '{host:s}:{port:d}/protocols'
      method: POST
      files:
        files: 'tests/integration/protocols/non_conforming_api_level.py'
    response:
      strict:
        - json:off
      save:
        json:
          protocol_id: data.id
          analysis_id: data.analysisSummaries[0].id
      status_code: 422