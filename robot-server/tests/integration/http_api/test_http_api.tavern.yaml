test_name: Test server health and OpenAPI spec
marks:
  - usefixtures:
      - run_server
stages:
  - name: GET /health GET request returns correct info
    request:
      url: '{host:s}:{port:d}/health'
      method: GET
    response:
      status_code: 200
      verify_response_with:
        function: 'tests.integration.fixtures:check_health_response'

  - name: GET /openapi.json succeeds without headers
    request:
      url: '{host:s}:{port:d}/openapi.json'
      method: GET
      headers:
        Opentrons-Version: null
    response:
      status_code: 200
