test_name: Test setting and getting a Flex deck configuration

marks:
  - ot3_only
  - usefixtures:
      - ot3_server_base_url

stages:
  - name: Set the deck configuration
    request:
      url: '{ot3_server_base_url}/deck_configuration'
      method: PUT
      json:
        data:
          cutoutFixtures: &expectedCutoutFixtures
            - cutoutFixtureId: singleLeftSlot
              cutoutId: cutoutA1
            - cutoutFixtureId: singleLeftSlot
              cutoutId: cutoutB1
            - cutoutFixtureId: singleLeftSlot
              cutoutId: cutoutC1
            - cutoutFixtureId: singleLeftSlot
              cutoutId: cutoutD1
            - cutoutFixtureId: singleCenterSlot
              cutoutId: cutoutA2
            - cutoutFixtureId: singleCenterSlot
              cutoutId: cutoutB2
            - cutoutFixtureId: singleCenterSlot
              cutoutId: cutoutC2
            - cutoutFixtureId: singleCenterSlot
              cutoutId: cutoutD2
            # Throw in a weird right-side deck layout
            # so we know this won't happen to match the default.
            - cutoutFixtureId: stagingAreaRightSlot
              cutoutId: cutoutA3
            - cutoutFixtureId: singleRightSlot
              cutoutId: cutoutB3
            - cutoutFixtureId: stagingAreaRightSlot
              cutoutId: cutoutC3
            - cutoutFixtureId: singleRightSlot
              cutoutId: cutoutD3

  - name: Get the deck configuration
    request:
      url: '{ot3_server_base_url}/deck_configuration'
    response:
      json:
        data:
          lastUpdatedAt: !anystr
          cutoutFixtures: *expectedCutoutFixtures
# TODO(mm, 2023-11-02):
#
# - Test that the server has a default deck configuration.
#   The default configuration will be different between OT-2 and Flex.
#
# - Test that the server rejects invalid deck configurations.
